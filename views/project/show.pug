extends ../layout
block content
  title= 'Project List'

  .container
    each project in projects
      h1=project.pro_name
      br
      br

      select#selectEE
        each plan in plans
          option=plan.status
      select#selectRL
        each plan in plans
          option=plan.cnt

    h2 프로젝트 진행 상태
      #piechart
   
      script(type='text/javascript', src='https://www.gstatic.com/charts/loader.js')
      script(type='text/javascript').
        var mix = new Array();
             //For error fix & Get data.
        $("#selectEE").hide();
        $("#selectRL").hide();
        var Finish = document.getElementById("selectEE").options[0].innerHTML;       
        var countFinish = document.getElementById("selectRL").options[0].innerHTML;
   
        var Late = document.getElementById("selectEE").options[1].innerHTML;       
        var countLate = document.getElementById("selectRL").options[1].innerHTML;

        var Progress = document.getElementById("selectEE").options[2].innerHTML;       
        var countProgress = document.getElementById("selectRL").options[2].innerHTML;
   
        // Load google charts
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChart);
        // Draw the chart and set the chart values
        function drawChart() {
        var data = google.visualization.arrayToDataTable([
        ['project', 'project status'],
        [Finish, parseInt(countFinish)],
        [Late, parseInt(countLate)],
        [Progress, parseInt(countProgress)],
        ]);
        // Optional; add a title and set the width and height of the chart
        var options = {'title':'', 'width':1500, 'height':400 } ;
        // Display the chart inside the <div> element with id="piechart"
        var chart = new google.visualization.PieChart(document.getElementById('piechart'));
        chart.draw(data, options);
        }

        $(document).ready(function(){
  

        });

    table.table.table-bordered.table-striped.table-hover
        h2 프로젝트 정보
        thead
        tr
            th 프로젝트명[PRO_NAME]
            th [PRO_ID]
            th 기관[PRO_ORG]
            th [PRO_START]
            th [PRO_DEADLINE]
        tbody
          each project in projects
            tr
                td=project.pro_name
                td=project.pro_org
                td=project.cus_name
                td=moment(project.pro_start).format("YYYY년 MM월 DD일")
                td=moment(project.pro_deadline).format("YYYY년 MM월 DD일")
    table.table.table-bordered.table-striped.table-hover
        thead
        tr
            th [ORDER_DATE]
            th [ORDER_CONTENT]
            th 기관[CUS_NAME]
        tbody
          each project in projects
            tr
                td=moment(project.order_date).format("YYYY년 MM월 DD일")
                td=project.order_content
                td=project.cus_name
    br
    table.table.table-bordered.table-striped.table-hover
        h2 프로젝트 참여자 명단
        br 
        h5 프로젝트 참여 인원 수 :
          =cnt.cnt
        input#myInput2.form-control(type='text', placeholder='참여자검색..')
        br
        thead
        tr
            th [EMP_NAME]  
            th 직무[EMP_ROLE]
            th 참여일[ER_START]
            th 종료일[ER_END]
            
        tbody#myTable2
        each emp_proj in emp_projs
          tr(href='#emp', data-toggle='collapse')
            td
              a(href=`/employee/${emp_proj.emp_id}`)= emp_proj.emp_name
            td=emp_proj.role_name
            td
              if(emp_proj.er_start)
                =moment(emp_proj.er_start).format("YYYY년 MM월 DD일")
            td
              if(emp_proj.er_end)
                =moment(emp_proj.er_end).format("YYYY년 MM월 DD일")

 

    h2 프로젝트 일정 차트
    br
    script(type='text/javascript', src='https://www.gstatic.com/charts/loader.js')
    script(type='text/javascript').
      google.charts.load('current', {'packages':['gantt']});
      google.charts.setOnLoadCallback(drawChart);
      function daysToMilliseconds(days) {
      return days * 24 * 60 * 60 * 1000;
      }
      function drawChart() {
      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Task ID');
      data.addColumn('string', 'Task Name');
      data.addColumn('string', 'Resource');
      data.addColumn('date', 'Start Date');
      data.addColumn('date', 'End Date');
      data.addColumn('number', 'Duration');
      data.addColumn('number', 'Percent Complete');
      data.addColumn('string', 'Dependencies');
      data.addRows([
      ['Research', 'Find sources', null,
      new Date(2015, 0, 1), new Date(2015, 0, 5), null,  100,  null],
      ['Write', 'Write paper', 'write',
      null, new Date(2015, 0, 9), daysToMilliseconds(3), 25, 'Research,Outline'],
      ['Cite', 'Create bibliography', 'write',
      null, new Date(2015, 0, 7), daysToMilliseconds(1), 20, 'Research'],
      ['Complete', 'Hand in paper', 'complete',
      null, new Date(2015, 0, 10), daysToMilliseconds(1), 0, 'Cite,Write'],
      ['Outline', 'Outline paper', 'write',
      null, new Date(2015, 0, 6), daysToMilliseconds(1), 100, 'Research']
      ]);
      var options = {
      height: 275
      };
      var chart = new google.visualization.Gantt(document.getElementById('chart_div'));
      chart.draw(data, options);
      }
    #chart_div


    .modal-footer
      a.btn.btn-dark(href='javascript:window.history.back();') Back
      br
      br
      a.btn.btn-primary(href=`/project/${projects[0].pro_id}/edit`) 프로젝트 수정
      a.btn.btn-secondary(data-url=`/project/${projects[0].pro_id}/delete`) 프로젝트 삭제
      
      br
    h3 Comments
      each answer in answers
          
        include _answer 
          br
          a.btn.btn-sm.btn-outline-danger(data-url=`/project/${answer.com_id}/delete_answer`) 댓글 삭제     
          
        hr       
    form(action=`/project/${projects[0].pro_id}/answers`, method='POST')
      .form-group
        label(for='answer') Your Answer
        textarea.form-control(name="content", rows="5")
      button.btn.btn-info(type="submit") Post Your Answer
      br
      br
    
  script.
      $(document).ready(function(){
      $("#myInput2").on("keyup", function() {
      var value = $(this).val().toLowerCase();
      $("#myTable2 tr").filter(function() {
      $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
      });
      });
      });
        $(function() {
          $('.btn-secondary').click(function() {
          if (confirm('Are you sure to delete?')) {
              location = $(this).data('url');
          }
          return false;
          });
      });

        $(function() {
          $('.btn-outline-danger').click(function() {
            if (confirm('Are you sure to delete?')) {
              location = $(this).data('url');
            }
            return false;
          });
        });
   

  br
  br

    